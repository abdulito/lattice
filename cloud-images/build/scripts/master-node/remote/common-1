#!/usr/bin/env bash
set -e

echo "Stopping kubelet and kube-proxy"
sudo systemctl stop kubelet
sudo systemctl stop kube-proxy

# Setup temp directory
mkdir -p ~/tmp
cd ~/tmp

echo "Installing etcd"
wget https://github.com/coreos/etcd/releases/download/v3.1.4/etcd-v3.1.4-linux-amd64.tar.gz
tar -xvf etcd-v3.1.4-linux-amd64.tar.gz
sudo mkdir -p /opt/etcd/bin
sudo mv etcd-v3.1.4-linux-amd64/etcd* /opt/etcd/bin/

echo "Pulling control plane docker images"
docker pull gcr.io/google_containers/hyperkube:v1.9.0

echo "Pulling latticectl"
docker pull gcr.io/lattice-dev/stable-debug-latticectl:latest

# Clean up after ourselves
cd ~
rm -rf ~/tmp

echo "Making temporary directory for base-node artifacts"
mkdir -p /tmp/kubernetes/artifacts/master-node
