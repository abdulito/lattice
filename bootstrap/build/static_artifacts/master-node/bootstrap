#!/usr/bin/env bash

STATUS=0
while [[ "${STATUS}" != "success" ]]
do
  sleep 10
  echo "Checking for cluster readiness"
  STATUS=$(systemctl is-active kubelet > /dev/null && /opt/kubernetes/bin/kubectl get nodes > /dev/null && echo "success")
  echo ${STATUS}
done

set -e
/opt/lattice/bin/master-seed-build-ssh-key
/opt/kubernetes/bin/kubectl create -R -f /etc/opt/lattice/bootstrap-kube-resources
